/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/BVHLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{AnimationClip,Bone,FileLoader,Loader,Quaternion,QuaternionKeyframeTrack,Skeleton,Vector3,VectorKeyframeTrack}from"../../../build/three.module.js";var BVHLoader=function(e){Loader.call(this,e),this.animateBonePositions=!0,this.animateBoneRotations=!0};BVHLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BVHLoader,load:function(e,o,r,t){var a=this,n=new FileLoader(a.manager);n.setPath(a.path),n.load(e,function(r){try{o(a.parse(r))}catch(o){t?t(o):console.error(o),a.manager.itemError(e)}},r,t)},parse:function(e){function o(e,r,t){if("ENDSITE"!==t.type){var a={time:r,position:new Vector3,rotation:new Quaternion};t.frames.push(a);for(var n=new Quaternion,i=new Vector3(1,0,0),s=new Vector3(0,1,0),p=new Vector3(0,0,1),l=0;l<t.channels.length;l++)switch(t.channels[l]){case"Xposition":a.position.x=parseFloat(e.shift().trim());break;case"Yposition":a.position.y=parseFloat(e.shift().trim());break;case"Zposition":a.position.z=parseFloat(e.shift().trim());break;case"Xrotation":n.setFromAxisAngle(i,parseFloat(e.shift().trim())*Math.PI/180),a.rotation.multiply(n);break;case"Yrotation":n.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),a.rotation.multiply(n);break;case"Zrotation":n.setFromAxisAngle(p,parseFloat(e.shift().trim())*Math.PI/180),a.rotation.multiply(n);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(l=0;l<t.children.length;l++)o(e,r,t.children[l])}}function r(e){for(var o;0===(o=e.shift().trim()).length;);return o}var t=this,a=function(e){"HIERARCHY"!==r(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var t=[],a=function e(o,t,a){var n={name:"",type:"",frames:[]};a.push(n);var i=t.split(/[\s]+/);"END"===i[0].toUpperCase()&&"SITE"===i[1].toUpperCase()?(n.type="ENDSITE",n.name="ENDSITE"):(n.name=i[1],n.type=i[0].toUpperCase()),"{"!==r(o)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),"OFFSET"!==(i=r(o).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+i[0]),4!==i.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var s=new Vector3(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]));if((isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),n.offset=s,"ENDSITE"!==n.type){"CHANNELS"!==(i=r(o).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var p=parseInt(i[1]);n.channels=i.splice(2,p),n.children=[]}for(;;){var l=r(o);if("}"===l)return n;n.children.push(e(o,l,a))}}(e,r(e),t);"MOTION"!==r(e)&&console.error("THREE.BVHLoader: MOTION expected.");var n=r(e).split(/[\s]+/),i=parseInt(n[1]);isNaN(i)&&console.error("THREE.BVHLoader: Failed to read number of frames."),n=r(e).split(/[\s]+/);var s=parseFloat(n[2]);isNaN(s)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var p=0;p<i;p++)o(n=r(e).split(/[\s]+/),p*s,a);return t}(e.split(/[\r\n]+/g)),n=[];!function e(o,r){var t=new Bone;if(r.push(t),t.position.add(o.offset),t.name=o.name,"ENDSITE"!==o.type)for(var a=0;a<o.children.length;a++)t.add(e(o.children[a],r));return t}(a[0],n);var i=function(e){for(var o=[],r=0;r<e.length;r++){var a=e[r];if("ENDSITE"!==a.type){for(var n=[],i=[],s=[],p=0;p<a.frames.length;p++){var l=a.frames[p];n.push(l.time),i.push(l.position.x+a.offset.x),i.push(l.position.y+a.offset.y),i.push(l.position.z+a.offset.z),s.push(l.rotation.x),s.push(l.rotation.y),s.push(l.rotation.z),s.push(l.rotation.w)}t.animateBonePositions&&o.push(new VectorKeyframeTrack(".bones["+a.name+"].position",n,i)),t.animateBoneRotations&&o.push(new QuaternionKeyframeTrack(".bones["+a.name+"].quaternion",n,s))}}return new AnimationClip("animation",-1,o)}(a);return{skeleton:new Skeleton(n),clip:i}}});export{BVHLoader};
//# sourceMappingURL=/sm/eba07e836ee58049036f92fcc07ee610bebf9545f1e53308a97b7f46b4271d06.map