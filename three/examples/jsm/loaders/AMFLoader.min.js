/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/AMFLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferGeometry,Color,FileLoader,Float32BufferAttribute,Group,Loader,LoaderUtils,Mesh,MeshPhongMaterial}from"../../../build/three.module.js";import{JSZip}from"../libs/jszip.module.min.js";var AMFLoader=function(e){Loader.call(this,e)};AMFLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AMFLoader,load:function(e,t,a,n){var r=this,o=new FileLoader(r.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.load(e,function(a){try{t(r.parse(a))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},a,n)},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,r={r:1,g:1,b:1,a:1},o=null,i=0;i<e.childNodes.length;i++){var l=e.childNodes[i];"metadata"===l.nodeName&&void 0!==l.attributes.type?"name"===l.attributes.type.value&&(t=l.textContent):"color"===l.nodeName&&(r=a(l))}return o=new MeshPhongMaterial({flatShading:!0,color:new Color(r.r,r.g,r.b),name:t}),1!==r.a&&(o.transparent=!0,o.opacity=r.a),{id:n,material:o}}function a(e){for(var t={r:1,g:1,b:1,a:1},a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function n(e){var t={name:"",triangles:[],materialid:null},a=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);a;){if("metadata"===a.nodeName)void 0!==a.attributes.type&&"name"===a.attributes.type.value&&(t.name=a.textContent);else if("triangle"===a.nodeName){var n=a.getElementsByTagName("v1")[0].textContent,r=a.getElementsByTagName("v2")[0].textContent,o=a.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,r,o)}a=a.nextElementSibling}return t}function r(e){for(var t=[],a=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var r=n.firstElementChild;r;){if("coordinates"===r.nodeName){var o=r.getElementsByTagName("x")[0].textContent,i=r.getElementsByTagName("y")[0].textContent,l=r.getElementsByTagName("z")[0].textContent;t.push(o,i,l)}else if("normal"===r.nodeName){var s=r.getElementsByTagName("nx")[0].textContent,m=r.getElementsByTagName("ny")[0].textContent,d=r.getElementsByTagName("nz")[0].textContent;a.push(s,m,d)}r=r.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:a}}function o(e){for(var t=e.attributes.id.textContent,o={name:"amfobject",meshes:[]},i=null,l=e.firstElementChild;l;){if("metadata"===l.nodeName)void 0!==l.attributes.type&&"name"===l.attributes.type.value&&(o.name=l.textContent);else if("color"===l.nodeName)i=a(l);else if("mesh"===l.nodeName){for(var s=l.firstElementChild,m={vertices:[],normals:[],volumes:[],color:i};s;){if("vertices"===s.nodeName){var d=r(s);m.normals=m.normals.concat(d.normals),m.vertices=m.vertices.concat(d.vertices)}else"volume"===s.nodeName&&m.volumes.push(n(s));s=s.nextElementSibling}o.meshes.push(m)}l=l.nextElementSibling}return{id:t,obj:o}}var i,l,s=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var a=null,n=null;console.log("THREE.AMFLoader: Loading Zip");try{a=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(n in a.files)if(".amf"===n.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+n),t=new DataView(a.file(n).asArrayBuffer())}var r=LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(r,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),m="",d="",u=function(e){var t=1,a="millimeter";void 0!==e.documentElement.attributes.unit&&(a=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[a]&&(t=n[a]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(s),c={},f={},g=s.documentElement.childNodes;for(i=0;i<g.length;i++){var v=g[i];if("metadata"===v.nodeName)void 0!==v.attributes.type&&("name"===v.attributes.type.value?m=v.textContent:"author"===v.attributes.type.value&&(d=v.textContent));else if("material"===v.nodeName){var h=t(v);c[h.id]=h.material}else if("object"===v.nodeName){var p=o(v);f[p.id]=p.obj}}var b=new Group,E=new MeshPhongMaterial({color:11184895,flatShading:!0});for(var N in b.name=m,b.userData.author=d,b.userData.loader="AMF",f){var C=f[N],x=C.meshes,y=new Group;for(y.name=C.name||"",i=0;i<x.length;i++){var M=E,w=x[i],L=new Float32BufferAttribute(w.vertices,3),A=null;if(w.normals.length&&(A=new Float32BufferAttribute(w.normals,3)),w.color){var F=w.color;(M=E.clone()).color=new Color(F.r,F.g,F.b),1!==F.a&&(M.transparent=!0,M.opacity=F.a)}var T=w.volumes;for(l=0;l<T.length;l++){var B=T[l],S=new BufferGeometry,j=M;S.setIndex(B.triangles),S.setAttribute("position",L.clone()),A&&S.setAttribute("normal",A.clone()),void 0!==c[B.materialId]&&(j=c[B.materialId]),S.scale(u,u,u),y.add(new Mesh(S,j.clone()))}}b.add(y)}return b}});export{AMFLoader};
//# sourceMappingURL=/sm/9fb7cac8798c48f7b9e576e5a7d60c811f23f7a240dd5f110ffa46fefb2f2dc5.map